# How MongoDB Stores Data - Visual Guide

## Quick Overview

When you use the Learnato Forum application, all data is saved to MongoDB. Here's how it works:

## Database Structure

```
learnato (Database)
├── users (Collection)
│   ├── Document 1: { _id, email, username, displayName, passwordHash, createdAt }
│   ├── Document 2: { _id, email, username, displayName, passwordHash, createdAt }
│   └── ...
├── posts (Collection)
│   ├── Document 1: { _id, title, content, votes, voters, authorId, createdAt, updatedAt }
│   ├── Document 2: { _id, title, content, votes, voters, authorId, createdAt, updatedAt }
│   └── ...
└── replies (Collection)
    ├── Document 1: { _id, postId, authorId, content, createdAt }
    ├── Document 2: { _id, postId, authorId, content, createdAt }
    └── ...
```

## How Data is Saved in MongoDB Compass

### Step 1: Connect to MongoDB

1. Open **MongoDB Compass**
2. Enter connection string: `mongodb://localhost:27017`
3. Click **Connect**

### Step 2: View the Database

1. You'll see a list of databases
2. Click on **`learnato`** database
3. You'll see 3 collections: `users`, `posts`, `replies`

### Step 3: View Collections

#### Users Collection

Click on `users` to see all registered users:

```json
{
  "_id": ObjectId("65a1b2c3d4e5f6a7b8c9d0e1"),
  "email": "alice@example.com",
  "username": "alice",
  "displayName": "Alice Smith",
  "passwordHash": "$2a$10$hashedpassword...",
  "createdAt": ISODate("2024-01-15T10:30:00.000Z")
}
```

**What you'll see:**
- Each user as a separate document
- `_id` is automatically generated by MongoDB
- `passwordHash` is encrypted (never plain text)
- `createdAt` shows when account was created

#### Posts Collection

Click on `posts` to see all forum posts:

```json
{
  "_id": ObjectId("65a1b2c3d4e5f6a7b8c9d0e2"),
  "title": "How to use MongoDB?",
  "content": "I'm learning MongoDB and have questions...",
  "votes": 3,
  "voters": [
    ObjectId("65a1b2c3d4e5f6a7b8c9d0e1"),
    ObjectId("65a1b2c3d4e5f6a7b8c9d0e3")
  ],
  "authorId": ObjectId("65a1b2c3d4e5f6a7b8c9d0e1"),
  "createdAt": ISODate("2024-01-15T11:00:00.000Z"),
  "updatedAt": ISODate("2024-01-15T12:30:00.000Z")
}
```

**What you'll see:**
- Each post as a separate document
- `authorId` references a user's `_id` from `users` collection
- `voters` is an array of user ObjectIds who upvoted
- `updatedAt` is set when post is edited

#### Replies Collection

Click on `replies` to see all replies:

```json
{
  "_id": ObjectId("65a1b2c3d4e5f6a7b8c9d0e4"),
  "postId": ObjectId("65a1b2c3d4e5f6a7b8c9d0e2"),
  "authorId": ObjectId("65a1b2c3d4e5f6a7b8c9d0e3"),
  "content": "Here's how you can get started...",
  "createdAt": ISODate("2024-01-15T11:30:00.000Z")
}
```

**What you'll see:**
- Each reply as a separate document
- `postId` references the post's `_id` from `posts` collection
- `authorId` references the user's `_id` from `users` collection

## Understanding Relationships

### How Posts Link to Users

1. **In `posts` collection**, find a post
2. **Copy the `authorId`** (e.g., `65a1b2c3d4e5f6a7b8c9d0e1`)
3. **Go to `users` collection**
4. **Filter by `_id`**: `{ "_id": ObjectId("65a1b2c3d4e5f6a7b8c9d0e1") }`
5. **See the author's details**

### How Replies Link to Posts

1. **In `replies` collection**, find a reply
2. **Copy the `postId`** (e.g., `65a1b2c3d4e5f6a7b8c9d0e2`)
3. **Go to `posts` collection**
4. **Filter by `_id`**: `{ "_id": ObjectId("65a1b2c3d4e5f6a7b8c9d0e2") }`
5. **See the original post**

### How to See All Replies for a Post

1. **In `posts` collection**, copy a post's `_id`
2. **Go to `replies` collection**
3. **Filter by `postId`**: `{ "postId": ObjectId("POST_ID_HERE") }`
4. **See all replies for that post**

## Data Flow Example

### When You Sign Up:

1. **Backend receives**: `{ email: "user@example.com", displayName: "John", password: "secret123" }`
2. **Backend hashes password**: `passwordHash = bcrypt.hash("secret123")`
3. **MongoDB saves**:
   ```json
   {
     "_id": ObjectId("..."),
     "email": "user@example.com",
     "displayName": "John",
     "passwordHash": "$2a$10$...",
     "createdAt": ISODate("...")
   }
   ```
4. **In Compass**: You'll see this document in `users` collection

### When You Create a Post:

1. **Backend receives**: `{ title: "My Post", content: "Hello!" }`
2. **Backend gets user ID** from JWT token
3. **MongoDB saves**:
   ```json
   {
     "_id": ObjectId("..."),
     "title": "My Post",
     "content": "Hello!",
     "authorId": ObjectId("USER_ID"),
     "votes": 0,
     "voters": [],
     "createdAt": ISODate("...")
   }
   ```
4. **In Compass**: You'll see this document in `posts` collection

### When You Add a Reply:

1. **Backend receives**: `{ content: "Great post!" }`
2. **Backend gets user ID** and post ID
3. **MongoDB saves**:
   ```json
   {
     "_id": ObjectId("..."),
     "postId": ObjectId("POST_ID"),
     "authorId": ObjectId("USER_ID"),
     "content": "Great post!",
     "createdAt": ISODate("...")
   }
   ```
4. **In Compass**: You'll see this document in `replies` collection

## Viewing Data in Compass - Step by Step

### 1. Open MongoDB Compass

- Launch the application
- Connect to `mongodb://localhost:27017`

### 2. Navigate to Database

- Click on **`learnato`** in the left sidebar
- You'll see 3 collections listed

### 3. View Users

- Click **`users`** collection
- See all registered users
- Click any document to view full details
- **Count**: Shows total number of users at the top

### 4. View Posts

- Click **`posts`** collection
- See all forum posts
- **Sort**: Click column headers to sort
- **Filter**: Use filter button to search
- **Count**: Shows total number of posts

### 5. View Replies

- Click **`replies`** collection
- See all replies
- **Filter by post**: `{ "postId": ObjectId("POST_ID") }`
- **Count**: Shows total number of replies

## Data Persistence

### Where is Data Stored?

- **On Disk**: MongoDB stores data in files on your hard drive
- **Location**: Usually `/data/db` (Linux/Mac) or `C:\data\db` (Windows)
- **Format**: BSON (Binary JSON) - efficient binary format
- **Persistence**: Data survives:
  - Server restarts ✅
  - Application crashes ✅
  - Computer reboots ✅
  - MongoDB service restarts ✅

### When is Data Saved?

- **Immediately**: When you create/update/delete
- **No delay**: Data is written to disk right away
- **Atomic**: Each operation is complete (no partial saves)

## Example: Complete Data View

### User Document
```json
{
  "_id": ObjectId("65a1b2c3d4e5f6a7b8c9d0e1"),
  "email": "john@example.com",
  "displayName": "John Doe",
  "passwordHash": "$2a$10$...",
  "createdAt": ISODate("2024-01-15T10:00:00.000Z")
}
```

### Post by That User
```json
{
  "_id": ObjectId("65a1b2c3d4e5f6a7b8c9d0e2"),
  "title": "My First Post",
  "content": "Hello everyone!",
  "votes": 2,
  "voters": [
    ObjectId("65a1b2c3d4e5f6a7b8c9d0e3"),
    ObjectId("65a1b2c3d4e5f6a7b8c9d0e4")
  ],
  "authorId": ObjectId("65a1b2c3d4e5f6a7b8c9d0e1"),  // Links to John
  "createdAt": ISODate("2024-01-15T11:00:00.000Z"),
  "updatedAt": null
}
```

### Reply to That Post
```json
{
  "_id": ObjectId("65a1b2c3d4e5f6a7b8c9d0e5"),
  "postId": ObjectId("65a1b2c3d4e5f6a7b8c9d0e2"),  // Links to post above
  "authorId": ObjectId("65a1b2c3d4e5f6a7b8c9d0e3"),  // Links to another user
  "content": "Nice post!",
  "createdAt": ISODate("2024-01-15T11:30:00.000Z")
}
```

## Key Points

1. **Collections = Tables** (in SQL terms)
2. **Documents = Rows** (in SQL terms)
3. **Fields = Columns** (in SQL terms)
4. **ObjectIds = Primary Keys** (unique identifiers)
5. **References = Foreign Keys** (links between collections)

## Visual Representation

```
┌─────────────────┐
│   users         │
├─────────────────┤
│ _id: "user1"    │◄─────┐
│ displayName:    │      │
│   "John"        │      │
└─────────────────┘      │
                         │ authorId references
┌─────────────────┐      │
│   posts         │      │
├─────────────────┤      │
│ _id: "post1"    │      │
│ title: "..."    │──────┘
│ authorId:       │
│   "user1"       │◄─────┐
└─────────────────┘      │
                         │ postId references
┌─────────────────┐      │
│   replies       │      │
├─────────────────┤      │
│ _id: "reply1"   │      │
│ postId: "post1"│──────┘
│ authorId:       │
│   "user2"       │
└─────────────────┘
```

## Summary

- **Database**: `learnato`
- **Collections**: `users`, `posts`, `replies`
- **Storage**: Persistent on disk
- **Viewing**: Use MongoDB Compass
- **Relationships**: ObjectIds link documents together
- **Data Format**: BSON (displayed as JSON in Compass)

Your data is safely stored in MongoDB and can be viewed anytime using MongoDB Compass!

